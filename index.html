<!doctype html><html><head><meta charset="utf-8">
    <title>Mis Películas</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body { --primary: #6200ee; --secondary: #29b6f6; margin: 0px;}
        * {font-family: 'Roboto', sans-serif;}
        button { 
            -webkit-font-smoothing: antialiased;
            display: inline-block;
            text-decoration: none;
            margin: 2px;
            color: var(--primary);
            background: white;
            border: 1px solid var(--primary);
            height: 20px;
            font-size: 9px;
            text-transform: uppercase;
            cursor: pointer;
            transition: ease-in 0.2s all;
            padding: 0 8px 0 8px;
        }
        div#main {padding: 10px;}
        input {margin-bottom: 5px; margin-top: 2px; padding: 4px; font-size: 12px; }
        h1 {background: var(--primary); color: white; font-weight: 300; text-transform: uppercase; font-size: 20px; margin: 0px; padding: 15px;}
        h2 { margin-block-start: 0px; margin-block-end: 10px; font-size: 20px;  color: var(--primary);}
        button:hover { background: var(--primary); color: white; }
        div.actions { margin-top: 10px;}
        div.movie {display: inline-block; width: auto; padding: 10px; box-shadow: 2px 2px 7px #ccc; margin: 5px;}
        div.movie div.movie-img {width: 200px; height: auto; min-height: 200px; cursor: pointer;}
        div.movie div.movie-img img {width: 100%; height: auto;}
        div.movie div.title {text-align: center; overflow: hidden; text-overflow: ellipsis; width: 200px; white-space: nowrap; }
        div.field {color: var(--primary); text-transform: uppercase; font-size: 12px;}
    </style>

    <script type="text/javascript">

        // MODELO DE DATOS

        let mis_resumenes_iniciales = [
            {titulo: "Viva La Música",   autor: "Andrés Caicedo", "miniatura": "files/Viva_La_Musica.png", resu:"¡Que Viva la Música! es una novela de iniciación.  Es la invitación a una fiesta sin fin, donde su protagonista dejará que el mundo baje hasta el pozo sin fondo de sus propios excesos. Pero con felicidad.  Con absoluta dicha.  Hay un pacto secreto con la muerte en esta danza de María del Carmen Huerta, la rubia protagonista de sus páginas.  Pero es la muerte dulce de las celebraciones: el paisaje, los afectos, la noche, la niñez que huye, la adolescencia triunfal, el rock and roll, los Rolling Stones, la salsa, Ricardo Ray, Bobby Cruz, las drogas, Cali (o Kali, según la ortografía de la narradora).  Es, así mismo, una iniciación al descubrimiento de una ciudad colombiana (única, mágica e irrepetible), que comienza por el cielo del norte, con su Avenida Sexta, su parque Versalles y sus parajes mágicos, hasta llegar al infierno del Sur con su caseta Panamericana, su río Pance, sus barrios más allá de Miraflores, su cordillera de los Andes alada y los refugios de la salsa y el sexo Andrés Caicedo, el autor de este viaje-hacia-el-deliro verbal, pondría fin a su vida el mismo día en que tuvo el ejemplar publicado de la presente novela.  El tiempo pasó mucho más rápido de lo que la muerte anticipa. ¡Que viva la música! se convirtió en un libro de culto, en un manifiesto generacional y en una especie de guía de los excesos, de manual de los bajos instintos, de tesoro de la juventud perdida, el cual se lee con el placer de aquel que se lanza hacia el abismo con una consigna: “tú enrúmbate y después derrúmbate”."},
            {titulo: "El Brillo de las Luciérnagas", autor: "Paul Pen", "miniatura": "files/Brillo.png",resu:"Unthriller que engancha de mano del apodado como «Stephen King español». Vivo en la oscuridad con mis padres, mi abuela, mi hermana y mi hermano. Todos están desfigurados por el fuego. Mi hermana lleva una máscara blanca para tapar sus quemaduras, porque papá dice que su cara podría asustarme. Me gusta mi cactus. Me gusta leer mi libro sobre insectos. Y tocar durante horas el único rayo de sol que se filtra por una rendija del techo. Pero desde que mi hermana tuvo al bebé, todos actúan de forma extraña. Creo que mienten sobre quién es el padre, sobre el hombre grillo que acecha por las noches, sobre lo que sucedió antes de que yo naciera, sobre por qué estamos aquí encerrados. Por lo menos tengo las luciérnagas. Llegaron hace unos días al sótano y las he guardado en un bote. Como dice mi abuela, no existe criatura más fascinante que aquella que es capaz de crear luz por sí misma. Esa luz me anima a conocer el mundo exterior, a escapar, a descubrir qué sucedió. Lo malo es que aquí todas las puertas están cerradas. Y no sé dónde voy a encontrar una salida..."},
            {titulo: "Rosario Tijeras",  autor: "Jorge Franco", "miniatura": "files/Rosario_Tijeras.png",resu:"Rosario, es una mujer peligrosa la cual fue abusada y violada a los ocho años por su padrastro. Unos vecinos la violaron a los 14 años, aunque después se vengó de uno de ellos cortándole los testículos con unas tijeras (de allí su apodo). Convertida en asesina y prostituta por su hermano mayor, que la vende a sus socios narcotraficantes. Rosario ya adulta proclamada como dueña de nadie, vive la vida al filo mientras intenta arreglar su pasado y los hombres en su vida, no haciendo las mejores elecciones por su camino.."}
        ];

        localStorage.mis_resumenes = localStorage.mis_resumenes || JSON.stringify(mis_resumenes_iniciales);

        // VISTAS
        const indexView = (resumenes) => {
            let i=0;
            let view = "";

            while(i < resumenes.length) {
              view += `
                <div class="movie">
                   <div class="movie-img">
                        <img data-my-id="${i}" src="${resumenes[i].miniatura}" onerror="this.src='files/placeholder.png'"/>
                   </div>
                   <div class="title">
                       ${resumenes[i].titulo || "<em>Sin título</em>"}
                   </div>
                   <div class="actions">
                        <!--Insertar aquí botones de "Show" y "Delete"-->
                       
                       <button class="show" data-my-id="${i}"> LEER MAS >> </button>
                       
                    </div>
                </div>\n`;
              i = i + 1;
            };

          /*  view += `<div class="actions">
                        <!--Insertar aquí botones de "Añadir" y "Reset"-->
                        <button class="new" > añadir </button>
                        <button class="reset" > reset </button>
                    </div>`;*/

            return view;
        };

        const editView = (i, resumen) => {
            return `<h2>Editar Película </h2>
                <div class="field">
                Título <br>
                <input  type="text" id="titulo" placeholder="Título" 
                        value="${resumen.titulo}">
                </div>
                <div class="field">
                Director <br>
                <input  type="text" id="autor" placeholder="Director" 
                        value="${resumen.autor}">
                </div>
                <div class="field">
                Miniatura <br>
                <input  type="text" id="miniatura" placeholder="URL de la miniatura" 
                        value="${resumen.miniatura}">
                </div>
                <div class="actions">
                    <button class="update" data-my-id="${i}">
                        Actualizar
                    </button>
                    <button class="index">
                        Volver
                    </button>
               `;
        }

        const showView = (resumen) => {
            // Completar: genera HTML con información de la película
            // ...

            return `
             <p>
                El Libro <b>${resumen.titulo}</b> de <b>${resumen.autor}</b>.
                
             </p>
             <p>
             <b>${resumen.resu}</b>
            </p>
           
             <div class="actions">
                <button class="index">Volver</button>
             </div>`;
        }

        const newView = () => {
            // Completar: genera formulario para crear nuevo quiz
            // ...

            return `<h2>Crear Película</h2>
             <div class="field">
                Título <br>
                <input type="text" id="titulo" placeholder="Título">
                </div>
                <div class="field">
                Director <br>
                <input type="text" id="autor" placeholder="Autor">
                </div>
                <div class="field">
                Miniatura <br>
                <input type="text" id="miniatura" placeholder="URL de la miniatura">
                </div>
                <div class="field">
                Resumen <br>
                <input type="text" id="resu" placeholder="Añadir Resumen">
                </div>
                <div class="actions">
                    <button class="index">Volver</button>
                    <button class="create"> Crear </button>
                </div>`;
        }


        // CONTROLADORES 
        const indexContr = () => {
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            document.getElementById('main').innerHTML = indexView(mis_resumenes);
        };

        const showContr = (i) => {
            // Completar: controlador que muestra la vista showView(resumen)
            // ...
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            document.getElementById('main').innerHTML = showView(mis_resumenes[i]);

        };

        const newContr = () => {
            // Completar: controlador que muestra la vista newView()
            // ...
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            document.getElementById('main').innerHTML = newView(mis_resumenes);

        };

        const createContr = () => {
            // Completar: controlador que crea una película nueva en el modelo guardado en localStorage
            // ...
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            let resumen_nuevo = {titulo: document.getElementById("titulo").value, autor: document.getElementById("autor").value, miniatura: document.getElementById("miniatura").value, resu: document.getElementById("resu").value};
            mis_resumenes.push(resumen_nuevo);
            localStorage.mis_resumenes = JSON.stringify(mis_resumenes);
            indexContr();
        };

        const editContr = (i) => {
            let resumen = JSON.parse(localStorage.mis_resumenes)[i];
            document.getElementById('main').innerHTML = editView(i, resumen);
        };

        const updateContr = (i) => {
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            mis_resumenes[i].titulo    = document.getElementById('titulo').value;
            mis_resumenes[i].autor  = document.getElementById('autor').value;
            mis_resumenes[i].miniatura = document.getElementById('miniatura').value;
            localStorage.mis_resumenes = JSON.stringify(mis_resumenes);
            indexContr();
        };

        const deleteContr = (i) => {
            // Completar:  controlador que actualiza el modelo borrando la película seleccionada
            // Genera diálogo de confirmación: botón Aceptar devuelve true, Cancel false
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            if(confirm(`Borrar ${mis_resumenes[i].titulo}`)){
                mis_resumenes.splice(i,1);
                localStorage.mis_resumenes = JSON.stringify(mis_resumenes);
                indexContr();
            }
        };

        const resetContr = () => {
            // Completar:  controlador que reinicia el modelo guardado en localStorage con las películas originales
            let mis_resumenes = JSON.parse(localStorage.mis_resumenes);
            localStorage.mis_resumenes = JSON.stringify(mis_resumenes_iniciales); //Guardas en el localstorage el objeto inicial que es dato
            indexContr();
        };

        // ROUTER de eventos
        const matchEvent = (ev, sel) => ev.target.matches(sel);
        const myId = (ev) => Number(ev.target.dataset.myId);

        document.addEventListener('click', ev => {
            if      (matchEvent(ev, '.index'))  indexContr  ();
            else if (matchEvent(ev, '.edit'))   editContr   (myId(ev));
            else if (matchEvent(ev, '.update')) updateContr (myId(ev));
            // Completar añadiendo los controladores que faltan
            else if (matchEvent(ev, '.new'))    newContr    ();
            else if (matchEvent(ev, '.create')) createContr ();
            else if (matchEvent(ev, '.reset'))  resetContr  ();
            else if (matchEvent(ev, '.show'))   showContr   (myId(ev));
            else if (matchEvent(ev, '.delete')) deleteContr (myId(ev));

        })
        
        
        // Inicialización        
        document.addEventListener('DOMContentLoaded', indexContr);
    </script>
</head>

<body>

    <h1>Resúmenes  <button class="new" > añadir </button></h1>
    <div id="main">
       
    
    
    
</body>
</html>


